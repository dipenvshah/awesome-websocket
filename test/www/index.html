<!DOCTYPE HTML>
<meta charset="UTF-8">

<html lang="en" ng-app='theApp'>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title></title>
  <script type="text/javascript" src="static/js/reconn.js> </script>
  <script type="text/javascript" src="static/js/angular.min.js"></script>
  <script type="text/javascript">
    function show(message){
      console.log(message);
      var container = document.createElement('p');
      if (typeof(message) === 'object'){
        message = JSON.stringify(message);
      }
      container.innerHTML = message;
      body = document.getElementsByTagName('body')[0];
      body.appendChild(container);
    }
    // this is only global for testing purposes
    // the significant change here (from v1) is that the client takes
    // an array of urls to connect to
    var ws = new WebSocket("ws://localhost:3000/");
    var dataThatWasntSent = null;
    ws.onmessage = function (m) { show(m); }
    ws.onerror = function (e) { show("Error: " + e); console.log(e); }
    ws.onclose = function () { show("socket has closed"); } 
    ws.onopen = function(e) {
      if ( dataThatWasntSent != null ){
        show("socket has opened with data: " + dataThatWasntSent);
        ws.send(dataThatWasntSent);
        dataThatWasntSent = null;
      } else {
        show("socket has opened");
      }
    };
    ws.ondatanotsent = function (data) {
      dataThatWasntSent = data;
    };

    angular.module('theApp', []).controller(
      'ConfigController',
      function($http, $scope){
        $scope.ws = ws;
        $scope.ping = function() { ws.send("ping"); };
        $scope.die = function() { ws.send("close"); };
      }
    );
  </script>
</head>
<body>
  <div ng-controller="ConfigController">
    <button ng-click="ping()">Send Ping</button>
    <button ng-click="die()">Die!</button>
  </div>
</body>
</html>
